export const socketlessjs = atob("CmNvbnN0IEJST1dTRVIgPSAiYnJvd3NlciI7CmNvbnN0IENMSUVOVCA9ICJjbGllbnQiOwoKY2xhc3MgUlBDRXJyb3IgewogIGNvbnN0cnVjdG9yKG9yaWdpbk5hbWUsIG1lc3NhZ2UpIHsKICAgIHRoaXMub3JpZ2luTmFtZSA9IG9yaWdpbk5hbWU7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogIH0KfQoKY29uc3QgREVCVUcgPSBmYWxzZTsKCi8vIGltcG9ydGluZyB0aGUgdXVpZCBwYWNrYWdlIGlzIHdheSB0b28gZXhwZW5zaXZlIGZvciB3aGF0IHdlIG5lZWQgaGVyZQpmdW5jdGlvbiB1dWlkKCkgewogIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoMTYpOwogIGNvbnN0IHJkbSA9ICgoMWU2ICogTWF0aC5yYW5kb20oKSkgfCAwKS50b1N0cmluZygxNik7CiAgcmV0dXJuIGAke25vd30tJHtyZG19YDsKfQoKLy8gcmVzcG9uc2VzIHNob3VsZCBhbHdheXMgYmUgInRoZSBldmVudCBuYW1lLCB3aXRoIDpyZXNwb25zZSBhZGRlZCIKZXhwb3J0IGNvbnN0IFJFU1BPTlNFX1NVRkZJWCA9IGA6cmVzcG9uc2VgOwpleHBvcnQgY29uc3QgZ2V0UmVzcG9uc2VOYW1lID0gKGV2ZW50TmFtZSkgPT4gYCR7ZXZlbnROYW1lfSR7UkVTUE9OU0VfU1VGRklYfWA7CgovLyB1c2Ugc3ltYm9scyBzbyB3ZSBkb24ndCBwb2xsdXRlIHRoZSBzb2NrZXQgcHJvdG90eXBlCmNvbnN0IE9SSUdJTiA9IFN5bWJvbChgb3JpZ2luYCk7CmNvbnN0IFBST1hZID0gU3ltYm9sKGBwcm94eWApOwpjb25zdCBSRUNFSVZFUiA9IFN5bWJvbChgcmVjZWl2ZXJgKTsKY29uc3QgUkVNT1RFID0gU3ltYm9sKGByZW1vdGVgKTsKY29uc3QgSEFORExFUlMgPSBTeW1ib2woYGhhbmRsZXJzYCk7CgovKioKICogLi4uCiAqLwpjbGFzcyBVcGdyYWRlZFNvY2tldCBleHRlbmRzIFdlYlNvY2tldCB7CiAgW09SSUdJTl0gPSB1bmRlZmluZWQ7IC8vIHRoZSBzb2NrZXQgb3duZXIgd2hvIGludm9rZWQgdGhlIHVwZ3JhZGUuIFNlZSB1cGdyYWRlKCkKICBbUFJPWFldID0gdW5kZWZpbmVkOyAvLyB0aGUgcHJveHkgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGlzIHNvY2tldAogIFtSRUNFSVZFUl0gPSBgYDsgLy8gbmFtZSBvZiB0aGUgcmVjZWl2aW5nIG9iamVjdAogIFtSRU1PVEVdID0gYGA7IC8vIG5hbWUgb2YgdGhlIHJlbW90ZSBvYmplY3QKICBbSEFORExFUlNdID0ge307IC8vIHRoZSBsaXN0IG9mIGV2ZW50IGhhbmRsZXJzLiBTZWUgdXBncmFkZSgpCgogIC8vIGV4cGxpY2l0bHkgZm9yYmlkIHRoZSBjb25zdHJ1Y3RvciBmcm9tIGJlaW5nIHVzZWQuCiAgLy8gQHRzLWlnbm9yZTogd2UgZG9uJ3QgbmVlZCB0byBjYWxsIHN1cGVyKCkgaWYgd2UgZXJyb3Igb3V0LgogIGNvbnN0cnVjdG9yKCkgewogICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAiQ2Fubm90IGNyZWF0ZSBVcGdyYWRlZFNvY2tldCBpbnN0YW5jZXMuIFVzZSBVcGdyYWRlZFNvY2tldC51cGdyYWRlKG5hbWUsIG9yaWdpbiwgc29ja2V0KSBpbnN0ZWFkLiIsCiAgICApOwogIH0KCiAgLy8gdXBncmFkZSBhIHNvY2tldCBmcm9tIHBsYWluIFdlYlNvY2tldCB0byB0aGlzIGNsYXNzIGluc3RlYWQuCiAgc3RhdGljIHVwZ3JhZGUoc29ja2V0LCBvcmlnaW4sIHJlY2VpdmVyLCByZW1vdGUpIHsKICAgIGlmIChzb2NrZXQgaW5zdGFuY2VvZiBVcGdyYWRlZFNvY2tldCkgcmV0dXJuIHNvY2tldDsKICAgIC8vIHVwZGF0ZSB0aGUgcHJvdG90eXBlIGJpbmRpbmcKICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihzb2NrZXQsIFVwZ3JhZGVkU29ja2V0LnByb3RvdHlwZSk7CiAgICAvLyBtYWtlIHN1cmUgdGhhdCBtZXNzYWdlcyBnbyB0aHJvdWdoIHRoZSByb3V0ZXI6CiAgICBzb2NrZXRbT1JJR0lOXSA9IG9yaWdpbjsKICAgIHNvY2tldFtSRUNFSVZFUl0gPSByZWNlaXZlcjsKICAgIHNvY2tldFtSRU1PVEVdID0gcmVtb3RlOwogICAgc29ja2V0W0hBTkRMRVJTXSA9IHt9OwogICAgY29uc3QgbWVzc2FnZVJvdXRlciA9IHNvY2tldC5yb3V0ZXIuYmluZChzb2NrZXQpOwogICAgaWYgKHNvY2tldC5vbikgewogICAgICBzb2NrZXQub24oYG1lc3NhZ2VgLCBtZXNzYWdlUm91dGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHNvY2tldC5vbm1lc3NhZ2UgPSBtZXNzYWdlUm91dGVyOwogICAgfQoKICAgIC8vIGNvbnZlbmllbmNlIHJldHVybi4KICAgIHJldHVybiBzb2NrZXQ7CiAgfQoKICAvLyBTcGVjaWFsIGFjY2Vzc29yIGZvciB1cGdyYWRlZCBzb2NrZXQgZnVuY3Rpb25zLAogIGdldCB1cGdyYWRlZCgpIHsKICAgIGlmICghdGhpcy5fX3VwZ3JhZGVkKSB7CiAgICAgIHRoaXMuX191cGdyYWRlZCA9IHsKICAgICAgICBvbjogKC4uLmFyZ3MpID0+IHRoaXMuX19vbiguLi5hcmdzKSwKICAgICAgICBvZmY6ICguLi5hcmdzKSA9PiB0aGlzLl9fb2ZmKC4uLmFyZ3MpLAogICAgICAgIHNlbmQ6ICguLi5hcmdzKSA9PiB0aGlzLl9fc2VuZCguLi5hcmdzKSwKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9fdXBncmFkZWQ7CiAgfQoKICAvLyBtZXNzYWdlIHJvdXRlciBzcGVjaWZpY2FsbHkgZm9yIHRoZSBtZXNzYWdlIGZvcm1hdCB1c2VkIGJ5IHRoZSBzb2NrZXRsZXNzIGNvZGUuCiAgYXN5bmMgcm91dGVyKG1lc3NhZ2UsIGZvcmNlZCA9IGZhbHNlKSB7CiAgICBjb25zdCB7IFtPUklHSU5dOiBvcmlnaW4sIFtSRUNFSVZFUl06IHJlY2VpdmVyLCBbUkVNT1RFXTogcmVtb3RlIH0gPSB0aGlzOwoKICAgIC8vIEFueSBjYWxscyBmcm9tIHRoZSBicm93c2VyIHRvIHRoZSB3ZWJjbGllbnQgYXJlIHRoYXQncyBhbHJlYWR5IGhhbmRsZWQKICAgIC8vIGJ5IHRoZSB3ZWJzb2NrZXQgZGlyZWN0bHkgKHNlZSB0aGUgY3JlYXRlV2ViQ2xpZW50IGZ1bmN0aW9uIGluIGluZGV4LmpzLAogICAgLy8gaW4gdGhlIHdzLm9uKGBjb25uZWN0aW9uYCwgLi4uKSBibG9jayksIHNvIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHRvIG5vdAogICAgLy8gdHJ5IHRvICJkb3VibGUtaGFuZGxlIiB0aGF0OgogICAgaWYgKHJlbW90ZSA9PT0gQlJPV1NFUiAmJiAhZm9yY2VkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBicm93c2VyIHdlYnNvY2tldD8gSWYgc28sIHVud3JhcCB0aGUgZGF0YQogICAgaWYgKG1lc3NhZ2Uuc3JjRWxlbWVudCkgewogICAgICBtZXNzYWdlID0gbWVzc2FnZS5kYXRhOwogICAgfQoKICAgIGxldCBkYXRhOwoKICAgIHRyeSB7CiAgICAgIGRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gY29uc29sZS5lcnJvcihgQ291bGQgbm90IHBhcnNlIHdlYnNvY2tldCBkYXRhOiAke21lc3NhZ2V9YCk7CiAgICB9CgogICAgY29uc3QgeyBuYW1lOiBldmVudE5hbWUsIHBheWxvYWQsIGVycm9yOiBlcnJvck1zZywgZGlmZiwgc2VxX251bSB9ID0gZGF0YTsKICAgIGxldCB7IHN0YXRlIH0gPSBkYXRhOwogICAgbGV0IHRocm93YWJsZSA9IGVycm9yTXNnID8gbmV3IFJQQ0Vycm9yKHJlY2VpdmVyLCBlcnJvck1zZykgOiB1bmRlZmluZWQ7CgogICAgaWYgKERFQlVHKQogICAgICBjb25zb2xlLmxvZyhgWyR7cmVjZWl2ZXJ9XS9bJHtyZW1vdGV9XSByb3V0ZXIgcnVubmluZyBnaXZlbjpgLCB7CiAgICAgICAgZXZlbnROYW1lLAogICAgICAgIHBheWxvYWQsCiAgICAgICAgZXJyb3JNc2csCiAgICAgICAgc3RhdGUsCiAgICAgICAgZGlmZiwKICAgICAgICBzZXFfbnVtLAogICAgICB9KTsKCiAgICAvLyBDbGllbnQtc3RhdGUgc3luY2hyb25pemF0aW9uIG1lY2hhbmlzbSBmb3IgdGhlIGJyb3dzZXI6CiAgICBpZiAoc3RhdGUgJiYgcmVjZWl2ZXIgPT09IEJST1dTRVIpIHsKICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgaGFuZGxpbmcgc3RhdGUgdXBkYXRlIGluIHRoZSBicm93c2VyYCwgc3RhdGUpOwogICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBvcmlnaW4gb2JqZWN0OmAsIHsgb3JpZ2luIH0pOwogICAgICBjb25zdCBwcmV2U3RhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9yaWdpbi5zdGF0ZSkpOwogICAgICBpZiAoZGlmZikgewogICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYHJlY2VpdmVkIGRpZmZgLCBzdGF0ZSk7CiAgICAgICAgY29uc3QgcGF0Y2ggPSBzdGF0ZTsKICAgICAgICBsZXQgdGFyZ2V0OwogICAgICAgIC8vIHZlcmlmeSB3ZSdyZSBzdGlsbCBpbiBzeW5jIGJ5IGNvbXBhcmluZyBtZXNzYWdpbmcgc2VxdWVuY2UgbnVtYmVycwogICAgICAgIGlmIChzZXFfbnVtID09PSBvcmlnaW4uX19zZXFfbnVtICsgMSkgewogICAgICAgICAgb3JpZ2luLl9fc2VxX251bSA9IHNlcV9udW07CiAgICAgICAgICB0YXJnZXQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHByZXZTdGF0ZSkpOwogICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgYXBwbHlpbmcgcGF0Y2ggdG9gLCB0YXJnZXQpOwogICAgICAgICAgLy8gQHRzLWlnbm9yZTogdGhpcyBvbmx5IHJ1bnMgaW4gdGhlIGJyb3dzZXIsIHdoZXJlIHJmYzY5MDIgaXMgYSBnbG9iYWwuCiAgICAgICAgICByZmM2OTAyLmFwcGx5UGF0Y2godGFyZ2V0LCBwYXRjaCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGlmIHdlIGdldCBoZXJlLCB3ZSdyZSBub3QgaW4gc3luYywgYW5kIHdlIG5lZWQgdG8gcmVxdWVzdCBhIGZ1bGwKICAgICAgICAgIC8vIHN0YXRlIG9iamVjdCBpbnN0ZWFkIG9mIHRyeWluZyB0byBhcHBseSBkaWZmZXJlbnRpYWwgdXBkYXRlcy4KICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYHNlcV9udW0gbWlzbWF0Y2gsIHN5bmNpbmcgc3RhdGVgKTsKICAgICAgICAgIGNvbnN0IGZ1bGxTdGF0ZSA9IGF3YWl0IHRoaXMuX19zZW5kKGBzeW5jU3RhdGVgKTsKICAgICAgICAgIG9yaWdpbi5fX3NlcV9udW0gPSAwOwogICAgICAgICAgdGFyZ2V0ID0gZnVsbFN0YXRlOwogICAgICAgIH0KICAgICAgICBzdGF0ZSA9IHRhcmdldDsKICAgICAgfQogICAgICAvLyBSdW4gdGhlIHVwZGF0ZSB3aXRoIHRoZSBuZXcgc3RhdGUgYXMgYXJndW1lbnQgZmlyc3QsIHRoZW4KICAgICAgLy8gb3ZlcndyaXRlIHRoZSBvbGQgc3RhdGUgd2l0aCB0aGUgbmV3IHN0YXRlIGFmdGVyIHRoZSB1cGRhdGUuCiAgICAgIG9yaWdpbi5zdGF0ZSA9IHN0YXRlOwogICAgICByZXR1cm4gb3JpZ2luLnVwZGF0ZShwcmV2U3RhdGUpOwogICAgfQoKICAgIC8vIElmIHRoaXMgaXMgYSByZXNwb25zZSBtZXNzYWdlLCBydW4gdGhlIGBvbmAgaGFuZGxlciBmb3IgdGhhdC4KICAgIGlmIChldmVudE5hbWUuZW5kc1dpdGgoUkVTUE9OU0VfU1VGRklYKSkgewogICAgICBjb25zdCB7IFtIQU5ETEVSU106IGhhbmRsZXJzIH0gPSB0aGlzOwogICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBbJHtyZWNlaXZlcn1dIHJlc3BvbnNlIG1lc3NhZ2UgcmVjZWl2ZWRgKTsKICAgICAgaWYgKCFoYW5kbGVyc1tldmVudE5hbWVdKSB0aHJvdyBuZXcgRXJyb3IoYG5vIGhhbmRsZXJzIGZvciAke2V2ZW50TmFtZX1gKTsKICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5mb3JFYWNoKChoYW5kbGVyKSA9PiB7CiAgICAgICAgaGFuZGxlcih0aHJvd2FibGUgPyB0aHJvd2FibGUgOiBwYXlsb2FkKTsKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBJZiB3ZSBnZXQgaGVyZSwgdGhpcyBpcyBhIHJlYWwgUlBDIGNhbGwgcmF0aGVyIHRoYW4gYSByZXNwb25zZSBvciBzdGF0ZSB1cGRhdGUuCiAgICBpZiAocGF5bG9hZCAmJiAhQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgYFske3JlY2VpdmVyfV0gcmVjZWl2ZWQgcGF5bG9hZCBmb3IgJHtldmVudE5hbWV9IGZyb20gWyR7cmVtb3RlfV0gYnV0IGl0IHdhcyBub3QgYW4gYXJyYXk/ICR7SlNPTi5zdHJpbmdpZnkoCiAgICAgICAgICBwYXlsb2FkLAogICAgICAgICAgbnVsbCwKICAgICAgICAgIDIsCiAgICAgICAgKX1gLAogICAgICApOwogICAgfQoKICAgIC8vIElmIGl0J3MgYSByZXF1ZXN0IG1lc3NhZ2UsIHJlc29sdmUgaXQgdG8gYSBmdW5jdGlvbiBjYWxsIGFuZCAicmV0dXJuIgogICAgLy8gdGhlIHZhbHVlIGJ5IHNlbmRpbmcgYSA6cmVzcG9uc2UgbWVzc2FnZSBvdmVyIHRoZSB3ZWJzb2NrZXQgaW5zdGVhZC4KICAgIGNvbnN0IHN0YWdlcyA9IGV2ZW50TmFtZS5zcGxpdChgOmApOwogICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgWyR7cmVjZWl2ZXJ9XSByb3V0ZXI6IHN0YWdlczpgLCBzdGFnZXMpOwoKICAgIGxldCBjYWxsYWJsZSA9IG9yaWdpbjsKICAgIGxldCBmb3JiaWRkZW4gPSBvcmlnaW4uX19wcm90b19fPy5jb25zdHJ1Y3Rvci5kaXNhbGxvd2VkQ2FsbHMgPz8gW107CiAgICBsZXQgZXJyb3IgPSB1bmRlZmluZWQ7CiAgICBsZXQgcmVzcG9uc2UgPSB1bmRlZmluZWQ7CgogICAgLy8gRmluZCB0aGUgYWN0dWFsIGZ1bmN0aW9uIHRvIGNhbGwKICAgIHRyeSB7CiAgICAgIGNvbnN0IFtmaXJzdF0gPSBzdGFnZXM7CiAgICAgIGlmIChzdGFnZXMubGVuZ3RoID09PSAxICYmIGZvcmJpZGRlbi5pbmNsdWRlcyhmaXJzdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYElsbGVnYWwgY2FsbDogJHtmaXJzdH0gaXMgYSBwcm90ZWN0ZWQgbWV0aG9kYCk7CiAgICAgIH0KICAgICAgd2hpbGUgKHN0YWdlcy5sZW5ndGgpIHsKICAgICAgICBjb25zdCBzdGFnZSA9IHN0YWdlcy5zaGlmdCgpOwogICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYGNoZWNraW5nICR7c3RhZ2V9YCk7CiAgICAgICAgY2FsbGFibGUgPSBjYWxsYWJsZVtzdGFnZV07CiAgICAgIH0KICAgICAgLy8gSWYgdGhpcyBjb2RlIHJ1bnMgb24gdGhlIHNlcnZlciwgdGhlIGZ1bmN0aW9uIG5lZWRzIHRvIGJlCiAgICAgIC8vIGNhbGxlZCB3aXRoIHRoZSBjbGllbnQgcHJveHkgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAgIGlmIChyZWNlaXZlciA9PT0gYHNlcnZlcmApIHBheWxvYWQudW5zaGlmdCh0aGlzW1BST1hZXSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vICJmdW5jdGlvbiBub3QgZm91bmQiIGRvZXNuJ3QgY291bnQgYXMgZXJyb3IgImhlcmUiLgogICAgICAvLyBJbnN0ZWFkLCB3ZSBzZW5kIHRoYXQgYmFjayB0byB0aGUgY2FsbGVyLgogICAgICBpZiAoREVCVUcpIGNvbnNvbGUuZXJyb3IoYGNhbm5vdCByZXNvbHZlICR7ZXZlbnROYW1lfSBvbiAke3JlY2VpdmVyfWAsIGUpOwogICAgICBlcnJvciA9IGUubWVzc2FnZTsKICAgIH0KCiAgICAvLyBSZXNvbHZlIHRoZSBmdW5jdGlvbiBhbmQgdGhlbiBzZW5kIHRoZSByZXN1bHQgYXMgOnJlc3BvbnNlLCBtYWtpbmcKICAgIC8vIHN1cmUgdG8gdGFrZSBpbnRvIGFjY291bnQgdGhhdCBhIGNhbGwgaXRzZWxmIG1pZ2h0IHRocm93LgogICAgaWYgKCFlcnJvcikgewogICAgICB0cnkgewogICAgICAgIHJlc3BvbnNlID0gKGF3YWl0IGNhbGxhYmxlLmJpbmQob3JpZ2luKSguLi5wYXlsb2FkKSkgPz8gdHJ1ZTsKICAgICAgICAvLyBJZiB0aGlzIGlzIGEgd2ViY2xpZW50LCBhbmQgdGhlcmUgaXMgYSBicm93c2VyIGNvbm5lY3RlZCwKICAgICAgICAvLyBhbHNvIG1ha2Ugc3VyZSB0byB0cmlnZ2VyIGEgc3RhdGUgc3luYywgc28gdGhhdCBjbGllbnQgY29kZQogICAgICAgIC8vIGRvZXMgbm90IG5lZWQgdG8gaW5jbHVkZSBzZXRTdGF0ZSBjYWxscyBhbGwgb3ZlciB0aGUgcGxhY2UuCiAgICAgICAgaWYgKHJlY2VpdmVyID09PSBDTElFTlQgJiYgb3JpZ2luLmJyb3dzZXIpIHsKICAgICAgICAgIG9yaWdpbi5zZXRTdGF0ZShvcmlnaW4uc3RhdGUpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChERUJVRykKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgICAgICAgIGBmdW5jdGlvbiBpbnZvY2F0aW9uIGZvciAke2V2ZW50TmFtZX0gZmFpbGVkIG9uICR7cmVjZWl2ZXJ9LCBwYXlsb2FkOmAsCiAgICAgICAgICAgIHBheWxvYWQsCiAgICAgICAgICApOwogICAgICAgIGlmIChERUJVRykgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBlcnJvciA9IGBDYW5ub3QgY2FsbCBbWyR7cmVjZWl2ZXJ9XV0uJHtldmVudE5hbWUucmVwbGFjZUFsbCgKICAgICAgICAgIGA6YCwKICAgICAgICAgIGAuYCwKICAgICAgICApfSwgZnVuY3Rpb24gaXMgbm90IGRlZmluZWQuYDsKICAgICAgfQogICAgfQoKICAgIC8vIFNlbmQgb2ZmIGEgcmVzcG9uc2UgbWVzc2FnZSB3aXRoIGVpdGhlciB0aGUgcmVzdWx0LCBvciB0aGUgZXJyb3IuCiAgICBjb25zdCByZXNwb25zZU5hbWUgPSBnZXRSZXNwb25zZU5hbWUoZXZlbnROYW1lKTsKICAgIGlmIChERUJVRykKICAgICAgY29uc29sZS5sb2coYFske3JlY2VpdmVyfV0gc2VuZGluZyAke3Jlc3BvbnNlTmFtZX1gLCB7CiAgICAgICAgcGF5bG9hZDogcmVzcG9uc2UsCiAgICAgICAgZXJyb3IsCiAgICAgIH0pOwogICAgc3VwZXIuc2VuZCgKICAgICAgSlNPTi5zdHJpbmdpZnkoeyBuYW1lOiByZXNwb25zZU5hbWUsIHBheWxvYWQ6IHJlc3BvbnNlLCBlcnJvciB9KSwKICAgICk7CiAgfQoKICAvKioKICAgKiB0aGlzLnVwZ3JhZGVkLm9uKCkgbWFkZSB0byB3b3JrIGxpa2UgLmFkZEV2ZW50TGlzdGVuZXIoKQogICAqLwogIF9fb24oZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICBjb25zdCB7IFtIQU5ETEVSU106IGhhbmRsZXJzIH0gPSB0aGlzOwogICAgaWYgKCFoYW5kbGVyc1tldmVudE5hbWVdKSBoYW5kbGVyc1tldmVudE5hbWVdID0gW107CiAgICBoYW5kbGVyc1tldmVudE5hbWVdLnB1c2goaGFuZGxlcik7CiAgICAvLyByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgIm9mZiIgZnVuY3Rpb24sIGZvciBjb252ZW5pZW5jZS4KICAgIHJldHVybiAoKSA9PiB0aGlzLl9fb2ZmKGV2ZW50TmFtZSwgaGFuZGxlcik7CiAgfQoKICAvKioKICAgKiB0aGlzLnVwZ3JhZGVkLm9mZigpIG1hZGUgdG8gd29yayBsaWtlIC5yZW1vdmVFdmVudExpc3RlbmVyKCkKICAgKi8KICBfX29mZihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IHsgW0hBTkRMRVJTXTogaGFuZGxlcnMgfSA9IHRoaXM7CiAgICBpZiAoIWhhbmRsZXJzW2V2ZW50TmFtZV0pIHJldHVybjsKICAgIGNvbnN0IHBvcyA9IGhhbmRsZXJzW2V2ZW50TmFtZV0uaW5kZXhPZihoYW5kbGVyKTsKICAgIGhhbmRsZXJzW2V2ZW50TmFtZV0uc3BsaWNlKHBvcywgMSk7CiAgfQoKICAvKioKICAgKiBBZGQgYSBwcm9taXNlLWJhc2VkIGVtaXQvcmVjZWl2ZSB0byB0aGUgc29ja2V0LCBzbyB0aGF0IGNhbGxpbmcgY29kZSBjYW4gYGF3YWl0YCB0aGUgcmVzcG9uc2UuCiAgICoKICAgKiBOb3RlIHRoYXQgdGhlcmUgaXMgYW4gb3B0aW9uYWwgdGhpcmQgYXJndW1lbnQgYHRpbWVvdXRgIHRoYXQgY2FuIGJlIHVzZWQgdG8gc2F5IGhvdyBsb25nIHRoZQogICAqIGVtaXQgc2hvdWxkIHdhaXQgYmVmb3JlIGRlY2lkaW5nIHRoZXJlIGlzIG5vIHJlc3BvbnNlIGZvcnRoY29taW5nIGFuZCB0byBjbGVhbiB1cCB0aGUgZXZlbnQKICAgKiBsaXN0ZW5lciBmb3IgdGhhdCByZXNwb25zZS4gVGhlIGRlZmF1bHQgdGltZW91dCBpcyAxMDAwbXMuCiAgICovCiAgYXN5bmMgX19zZW5kKGV2ZW50TmFtZSwgZGF0YSA9IHt9LCB0aW1lb3V0ID0gMTAwMCkgewogICAgY29uc3QgeyBbUkVDRUlWRVJdOiByZWNlaXZlciwgW1JFTU9URV06IHJlbW90ZSB9ID0gdGhpczsKICAgIGlmIChERUJVRykKICAgICAgY29uc29sZS5sb2coYFske3JlY2VpdmVyfV0gc2VuZGluZyBbJHtldmVudE5hbWV9XSB0byBbJHtyZW1vdGV9XTpgLCBkYXRhKTsKICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IHJlc3BvbnNlTmFtZSA9IGdldFJlc3BvbnNlTmFtZShldmVudE5hbWUpOwoKICAgICAgLy8gY2xlYW51cCBmdW5jdGlvbiBmb3IgdGhlIGV2ZW50IGxpc3RlbmVyCiAgICAgIGxldCBjbGVhbnVwID0gKGRhdGEgPSB1bmRlZmluZWQpID0+IHsKICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBbJHtyZWNlaXZlcn1dIGNsZWFudXBgKTsKICAgICAgICAvLyBjbGVhbiB1cCBhbmQgYmVjb21lIGEgbm9vcCBzbyB3ZSBjYW4ndCBiZSByZXRyaWdnZXJlZC4KICAgICAgICB0aGlzLl9fb2ZmKHJlc3BvbnNlTmFtZSwgaGFuZGxlcik7CiAgICAgICAgY2xlYW51cCA9ICgpID0+IHt9OwogICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgIH07CgogICAgICAvLyBJbiBvcmRlciB0byByZXNvbHZlIHRoZSBQcm9taXNlLCB3ZSB3aWxsIGJlIGxpc3RlbmluZwogICAgICAvLyBmb3IgdGhhdCBldmVudE5hbWU6cmVzcG9uc2UsIGFuZCB3aGVuIHdlIHJlY2VpdmUgaXQsCiAgICAgIC8vIHdlJ2xsIGltbWVkaWF0ZWx5IFNUT1AgbGlzdGVuaW5nIGZvciBzaW1pbGFyIHJlc3BvbnNlcwogICAgICAvLyBiZWNhdXNlIHdlIG5vIGxvbmdlciBjYXJlLgogICAgICBjb25zdCBoYW5kbGVyID0gKGRhdGEpID0+IGNsZWFudXAoZGF0YSk7CgogICAgICAvLyBGaXJzdCwgbWFrZSBzdXJlIHdlJ3JlIHJlYWR5IHRvIHJlY2VpdmUgdGhlIHJlc3BvbnNlLi4uCiAgICAgIHRoaXMuX19vbihyZXNwb25zZU5hbWUsIChkYXRhKSA9PiB7CiAgICAgICAgaWYgKERFQlVHKQogICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgIGBbJHtyZWNlaXZlcn1dIGhhbmRsaW5nIHJlc3BvbnNlIGZvciAke2V2ZW50TmFtZX0gZnJvbSBbJHtyZW1vdGV9XTpgLAogICAgICAgICAgKTsKICAgICAgICBoYW5kbGVyKGRhdGEpOwogICAgICB9KTsKCiAgICAgIC8vIEFuZCB0aGVuLCBzZW5kIHRoZSBldmVudCBvZmYgdG8gdGhlIGNsaWVudC4KICAgICAgY29uc3Qgc2VuZEV2ZW50ID0gKCkgPT4gewogICAgICAgIGlmIChERUJVRykKICAgICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgICBgKHJhdykgc2VuZGluZyAke2V2ZW50TmFtZX0gZnJvbSAke3JlY2VpdmVyfSB0byAke3JlbW90ZX1gLAogICAgICAgICAgKTsKICAgICAgICBzdXBlci5zZW5kKAogICAgICAgICAgSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBuYW1lOiBldmVudE5hbWUsCiAgICAgICAgICAgIHBheWxvYWQ6IGRhdGEsCiAgICAgICAgICB9KSwKICAgICAgICApOwogICAgICB9OwoKICAgICAgLy8gV2UgbWF5IGJlIHRyeWluZyB0byBzZW5kIGJlZm9yZSB0aGUgc29ja2V0IGlzIG9wZW4gaW4gYnJvd3NlciBsYW5kLAogICAgICAvLyBzbyBpZiB0aGUgc29ja2V0J3Mgbm90IHJlYWR5LCAicXVldWUiIHRoZSBldmVudCB0byBmaXJlIG9uIG9wZW4uCiAgICAgIGlmIChzdXBlci5yZWFkeVN0YXRlID09PSAxKSBzZW5kRXZlbnQoKTsKICAgICAgZWxzZSBzdXBlci5vbm9wZW4gPSBzZW5kRXZlbnQ7CgogICAgICAvLyBBbmQgbWFrZSBzdXJlIHRoYXQgaWYgbm8gcmVzcG9uc2UgaGFzIG9jY3VycmVkIHdpdGhpbgogICAgICAvLyBgdGltZW91dGAgbWlsbGlzZWNvbmRzLCB3ZSBjbGVhbiB1cCB0aGUgbGlzdGVuZXIuCiAgICAgIGlmIChpc0Zpbml0ZSh0aW1lb3V0KSkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gY2xlYW51cCgpLCB0aW1lb3V0KTsKICAgICAgfQogICAgfSk7CiAgfQp9CgovKioKICogQSBzb2NrZXQgcHJveHkgZm9yIFJQQyBwdXJwb3Nlcy4KICovCmNsYXNzIFNvY2tldFByb3h5IGV4dGVuZHMgRnVuY3Rpb24gewogIGNvbnN0cnVjdG9yKHNvY2tldCwgcmVjZWl2ZXIsIHJlbW90ZSwgcGF0aCA9IGBgKSB7CiAgICBzdXBlcigpOwogICAgdGhpc1tSRUNFSVZFUl0gPSByZWNlaXZlcjsKICAgIHRoaXNbUkVNT1RFXSA9IHJlbW90ZTsKICAgIHRoaXMuaWQgPSB1dWlkKCk7CiAgICB0aGlzLnBhdGggPSBwYXRoOwogICAgdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICByZXR1cm4gbmV3IFByb3h5KHRoaXMsIHsKICAgICAgZ2V0OiAoXywgcHJvcCkgPT4gewogICAgICAgIGlmIChwcm9wID09PSAiaWQiKSByZXR1cm4gdGhpcy5pZDsKICAgICAgICBpZiAocHJvcCA9PT0gInNvY2tldCIpIHJldHVybiB0aGlzLnNvY2tldDsKICAgICAgICAvLyBAdHMtaWdub3JlOiB3ZSdyZSBuZXZlciBpbnZva2luZyB0aGlzIHdpdGggU3ltYm9sIGFzIHNlY29uZCBhcmd1bWVudAogICAgICAgIHJldHVybiBuZXcgU29ja2V0UHJveHkoc29ja2V0LCByZWNlaXZlciwgcmVtb3RlLCBgJHtwYXRofToke3Byb3B9YCk7CiAgICAgIH0sCiAgICAgIGFwcGx5OiBhc3luYyAoXywgX18sIGFyZ3MpID0+IHsKICAgICAgICBpZiAoREVCVUcpCiAgICAgICAgICBjb25zb2xlLmxvZygKICAgICAgICAgICAgYFtTUGFwcGx5XSBzZW5kaW5nICR7dGhpcy5wYXRoLnN1YnN0cmluZygxKX0gcmVjZWl2ZXIgJHsKICAgICAgICAgICAgICB0aGlzW1JFQ0VJVkVSXQogICAgICAgICAgICB9IHRvICR7dGhpc1tSRU1PVEVdfWAsCiAgICAgICAgICApOwoKICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5zb2NrZXQudXBncmFkZWQuc2VuZCgKICAgICAgICAgIHRoaXMucGF0aC5zdWJzdHJpbmcoMSksCiAgICAgICAgICBhcmdzLAogICAgICAgICAgdGhpc1tSRU1PVEVdID09PSBCUk9XU0VSID8gSW5maW5pdHkgOiB1bmRlZmluZWQsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBSUENFcnJvcikgewogICAgICAgICAgY29uc3QgYXJnc3RyID0gWy4uLm5ldyBBcnJheShhcmdzLmxlbmd0aCldCiAgICAgICAgICAgIC5tYXAoKF8sIGkpID0+IFN0cmluZy5mcm9tQ2hhckNvZGUoOTcgKyBpKSkKICAgICAgICAgICAgLmpvaW4oYCxgKTsKCiAgICAgICAgICBpZiAoREVCVUcpCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgICAgICAgICAgYEVSUk9SIGNhbGxpbmcgW1ske2RhdGEub3JpZ2luTmFtZX1dXS4ke3RoaXMucGF0aAogICAgICAgICAgICAgICAgLnN1YnN0cmluZygxKQogICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoYDpgLCBgLmApfSgke2FyZ3N0cn0pOiAke2RhdGEubWVzc2FnZX1gLAogICAgICAgICAgICApOwoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLm1lc3NhZ2UpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0sCiAgICB9KTsKICB9Cn0KCi8qKgogKiAuLmRvY3MgZ28gaGVyZS4uLgogKiBAcGFyYW0ge3N0cmluZ30gcmVjZWl2ZXIKICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZQogKiBAcGFyYW0geyp9IG9yaWdpbgogKiBAcGFyYW0geyp9IHNvY2tldAogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gcHJveHlTb2NrZXQocmVjZWl2ZXIsIHJlbW90ZSwgb3JpZ2luLCBzb2NrZXQpIHsKICBzb2NrZXQgPSBVcGdyYWRlZFNvY2tldC51cGdyYWRlKHNvY2tldCwgb3JpZ2luLCByZWNlaXZlciwgcmVtb3RlKTsKICByZXR1cm4gKHNvY2tldFtQUk9YWV0gPSBuZXcgU29ja2V0UHJveHkoc29ja2V0LCByZWNlaXZlciwgcmVtb3RlKSk7Cn0KCgogICAgZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVdlYkNsaWVudChXZWJDbGllbnRDbGFzcykgewogICAgICBjb25zdCBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpLnJlcGxhY2UoImh0dHAiLCAid3MiKSk7CiAgICAgIGNvbnN0IGJyb3dzZXJDbGllbnQgPSBuZXcgV2ViQ2xpZW50Q2xhc3MoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJyb3dzZXJDbGllbnQsICJzb2NrZXQiLCB7CiAgICAgICAgdmFsdWU6IHNvY2tldCwKICAgICAgICB3cml0YWJsZTogZmFsc2UsCiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJyb3dzZXJDbGllbnQsICJzZXJ2ZXIiLCB7CiAgICAgICAgdmFsdWU6IHByb3h5U29ja2V0KCJicm93c2VyIiwgIndlYmNsaWVudCIsIGJyb3dzZXJDbGllbnQsIHNvY2tldCksCiAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsCiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShicm93c2VyQ2xpZW50LCAicXVpdCIsIHsKICAgICAgICB2YWx1ZTogKCkgPT4gYnJvd3NlckNsaWVudC5zZXJ2ZXIuZGlzY29ubmVjdCgpCiAgICAgIH0pOwogICAgICBicm93c2VyQ2xpZW50LnN0YXRlID0ge307CiAgICAgIGJyb3dzZXJDbGllbnQuaW5pdCgpOwogICAgICByZXR1cm4gYnJvd3NlckNsaWVudDsKICAgIH07CiAgCihmdW5jdGlvbihwLHIpeyJvYmplY3QiPT09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT09dHlwZW9mIG1vZHVsZT9yKGV4cG9ydHMpOiJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbImV4cG9ydHMiXSxyKToocD0idW5kZWZpbmVkIiE9PXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6cHx8c2VsZixyKHAucmZjNjkwMj17fSkpfSkodGhpcyxmdW5jdGlvbihwKXtmdW5jdGlvbiByKGEpe3JldHVybiBhLnJlcGxhY2UoL34xL2csIi8iKS5yZXBsYWNlKC9+MC9nLCJ+Iil9ZnVuY3Rpb24gRShhKXtyZXR1cm4gYS5yZXBsYWNlKC9+L2csIn4wIikucmVwbGFjZSgvXC8vZywifjEiKX1mdW5jdGlvbiB6KGEpe3JldHVybiB2b2lkIDA9PT1hPyJ1bmRlZmluZWQiOm51bGw9PT1hPyJudWxsIjpBcnJheS5pc0FycmF5KGEpPyJhcnJheSI6dHlwZW9mIGF9ZnVuY3Rpb24gdihhKXtpZihudWxsPT1hfHwib2JqZWN0IiE9dHlwZW9mIGEpcmV0dXJuIGE7CmlmKGEuY29uc3RydWN0b3I9PUFycmF5KXt2YXIgYj1hLmxlbmd0aCxjPUFycmF5KGIpO2ZvcihsZXQgZD0wO2Q8YjtkKyspY1tkXT12KGFbZF0pO3JldHVybiBjfWlmKGEuY29uc3RydWN0b3I9PURhdGUpcmV0dXJuIG5ldyBEYXRlKCthKTtiPXt9O2ZvcihjIGluIGEpdy5jYWxsKGEsYykmJihiW2NdPXYoYVtjXSkpO3JldHVybiBifWZ1bmN0aW9uIEYoe29wOmF9KXtyZXR1cm4icmVtb3ZlIj09PWF8fCJyZXBsYWNlIj09PWF8fCJjb3B5Ij09PWF8fCJtb3ZlIj09PWF9ZnVuY3Rpb24gQShhLGIpe2NvbnN0IGM9e307Zm9yKGNvbnN0IGQgaW4gYSl3LmNhbGwoYSxkKSYmdm9pZCAwIT09YVtkXSYmKGNbZF09MSk7Zm9yKGNvbnN0IGQgaW4gYil3LmNhbGwoYixkKSYmdm9pZCAwIT09YltkXSYmZGVsZXRlIGNbZF07cmV0dXJuIE9iamVjdC5rZXlzKGMpfWZ1bmN0aW9uIEcoYSl7Y29uc3QgYj1hLmxlbmd0aCxjPXt9O2ZvcihsZXQgZD0wO2Q8YjtkKyspe2NvbnN0IGU9YVtkXTtmb3IoY29uc3QgZiBpbiBlKXcuY2FsbChlLApmKSYmdm9pZCAwIT09ZVtmXSYmKGNbZl09KGNbZl18fDApKzEpfWZvcihjb25zdCBkIGluIGMpY1tkXTxiJiZkZWxldGUgY1tkXTtyZXR1cm4gT2JqZWN0LmtleXMoYyl9ZnVuY3Rpb24geChhLGIpe3JldHVybntvcGVyYXRpb25zOmEub3BlcmF0aW9ucy5jb25jYXQoYiksY29zdDphLmNvc3QrMX19ZnVuY3Rpb24gSChhLGIsYyxkPXEpe2Z1bmN0aW9uIGUoayxnKXtjb25zdCBoPWAke2t9LCR7Z31gO3ZhciBsPWZbaF07aWYodm9pZCAwPT09bCl7aWYoMDxrJiYwPGcmJiFkKGFbay0xXSxiW2ctMV0sYy5hZGQoU3RyaW5nKGstMSkpKS5sZW5ndGgpbD1lKGstMSxnLTEpO2Vsc2V7bD1bXTtpZigwPGspe3ZhciB0PWUoay0xLGcpO2wucHVzaCh4KHQse29wOiJyZW1vdmUiLGluZGV4OmstMX0pKX0wPGcmJih0PWUoayxnLTEpLGwucHVzaCh4KHQse29wOiJhZGQiLGluZGV4OmstMSx2YWx1ZTpiW2ctMV19KSkpOzA8ayYmMDxnJiYodD1lKGstMSxnLTEpLGwucHVzaCh4KHQse29wOiJyZXBsYWNlIiwKaW5kZXg6ay0xLG9yaWdpbmFsOmFbay0xXSx2YWx1ZTpiW2ctMV19KSkpO2w9bC5zb3J0KChJLEopPT5JLmNvc3QtSi5jb3N0KVswXX1mW2hdPWx9cmV0dXJuIGx9Y29uc3QgZj17IjAsMCI6e29wZXJhdGlvbnM6W10sY29zdDowfX0sQj1pc05hTihhLmxlbmd0aCl8fDA+PWEubGVuZ3RoPzA6YS5sZW5ndGg7dmFyIHU9aXNOYU4oYi5sZW5ndGgpfHwwPj1iLmxlbmd0aD8wOmIubGVuZ3RoO3U9ZShCLHUpLm9wZXJhdGlvbnM7W3VdPXUucmVkdWNlKChbayxnXSxoKT0+e2lmKCJhZGQiPT09aC5vcCl7dmFyIGw9aC5pbmRleCsxK2c7aD17b3A6aC5vcCxwYXRoOmMuYWRkKGw8QitnP1N0cmluZyhsKToiLSIpLnRvU3RyaW5nKCksdmFsdWU6aC52YWx1ZX07cmV0dXJuW2suY29uY2F0KGgpLGcrMV19aWYoInJlbW92ZSI9PT1oLm9wKXJldHVybiBoPXtvcDpoLm9wLHBhdGg6Yy5hZGQoU3RyaW5nKGguaW5kZXgrZykpLnRvU3RyaW5nKCl9LFtrLmNvbmNhdChoKSxnLTFdO2w9Yy5hZGQoU3RyaW5nKGguaW5kZXgrCmcpKTtoPWQoaC5vcmlnaW5hbCxoLnZhbHVlLGwpO3JldHVybltrLmNvbmNhdCguLi5oKSxnXX0sW1tdLDBdKTtyZXR1cm4gdX1mdW5jdGlvbiBLKGEsYixjLGQ9cSl7Y29uc3QgZT1bXTtBKGEsYikuZm9yRWFjaChmPT57ZS5wdXNoKHtvcDoicmVtb3ZlIixwYXRoOmMuYWRkKGYpLnRvU3RyaW5nKCl9KX0pO0EoYixhKS5mb3JFYWNoKGY9PntlLnB1c2goe29wOiJhZGQiLHBhdGg6Yy5hZGQoZikudG9TdHJpbmcoKSx2YWx1ZTpiW2ZdfSl9KTtHKFthLGJdKS5mb3JFYWNoKGY9PntlLnB1c2goLi4uZChhW2ZdLGJbZl0sYy5hZGQoZikpKX0pO3JldHVybiBlfWZ1bmN0aW9uIHEoYSxiLGMsZD1xKXtpZihhPT09YilyZXR1cm5bXTtjb25zdCBlPXooYSksZj16KGIpO3JldHVybiJhcnJheSI9PWUmJiJhcnJheSI9PWY/SChhLGIsYyxkKToib2JqZWN0Ij09ZSYmIm9iamVjdCI9PWY/SyhhLGIsYyxkKTpbe29wOiJyZXBsYWNlIixwYXRoOmMudG9TdHJpbmcoKSx2YWx1ZTpifV19ZnVuY3Rpb24geShhLApiLGMpe0FycmF5LmlzQXJyYXkoYSk/Ii0iPT1iP2EucHVzaChjKTooYj1wYXJzZUludChiLDEwKSxhLnNwbGljZShiLDAsYykpOmFbYl09Y31mdW5jdGlvbiBDKGEsYil7QXJyYXkuaXNBcnJheShhKT8oYj1wYXJzZUludChiLDEwKSxhLnNwbGljZShiLDEpKTpkZWxldGUgYVtiXX1mdW5jdGlvbiBMKGEsYil7YT1tLmZyb21KU09OKGIucGF0aCkuZXZhbHVhdGUoYSk7aWYobnVsbD09PWEucGFyZW50KXJldHVybiBuZXcgbihiLnBhdGgpO2lmKEFycmF5LmlzQXJyYXkoYS5wYXJlbnQpKXtpZihwYXJzZUludChhLmtleSwxMCk+PWEucGFyZW50Lmxlbmd0aClyZXR1cm4gbmV3IG4oYi5wYXRoKX1lbHNlIGlmKHZvaWQgMD09PWEudmFsdWUpcmV0dXJuIG5ldyBuKGIucGF0aCk7YS5wYXJlbnRbYS5rZXldPWIudmFsdWU7cmV0dXJuIG51bGx9ZnVuY3Rpb24gTShhLGIpe3N3aXRjaChiLm9wKXtjYXNlICJhZGQiOnJldHVybiBhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT0KYS5wYXJlbnQ/Yj1uZXcgbihiLnBhdGgpOih5KGEucGFyZW50LGEua2V5LHYoYi52YWx1ZSkpLGI9bnVsbCksYjtjYXNlICJyZW1vdmUiOnJldHVybiBhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT1hLnZhbHVlP2I9bmV3IG4oYi5wYXRoKTooQyhhLnBhcmVudCxhLmtleSksYj1udWxsKSxiO2Nhc2UgInJlcGxhY2UiOnJldHVybiBMKGEsYik7Y2FzZSAibW92ZSI6dmFyIGM9bS5mcm9tSlNPTihiLmZyb20pLmV2YWx1YXRlKGEpO3ZvaWQgMD09PWMudmFsdWU/Yj1uZXcgbihiLmZyb20pOihhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT1hLnBhcmVudD9iPW5ldyBuKGIucGF0aCk6KEMoYy5wYXJlbnQsYy5rZXkpLHkoYS5wYXJlbnQsYS5rZXksYy52YWx1ZSksYj1udWxsKSk7cmV0dXJuIGI7Y2FzZSAiY29weSI6cmV0dXJuIGM9bS5mcm9tSlNPTihiLmZyb20pLmV2YWx1YXRlKGEpLHZvaWQgMD09PWMudmFsdWU/Yj1uZXcgbihiLmZyb20pOgooYT1tLmZyb21KU09OKGIucGF0aCkuZXZhbHVhdGUoYSksdm9pZCAwPT09YS5wYXJlbnQ/Yj1uZXcgbihiLnBhdGgpOih5KGEucGFyZW50LGEua2V5LHYoYy52YWx1ZSkpLGI9bnVsbCkpLGI7Y2FzZSAidGVzdCI6cmV0dXJuIGE9bS5mcm9tSlNPTihiLnBhdGgpLmV2YWx1YXRlKGEpLGI9cShhLnZhbHVlLGIudmFsdWUsbmV3IG0pLmxlbmd0aD9uZXcgTihhLnZhbHVlLGIudmFsdWUpOm51bGwsYn1yZXR1cm4gbmV3IE8oYil9ZnVuY3Rpb24gUChhKXtmdW5jdGlvbiBiKGMsZCxlKXtjb25zdCBmPWEoYyxkLGUpO3JldHVybiBBcnJheS5pc0FycmF5KGYpP2Y6cShjLGQsZSxiKX1yZXR1cm4gYn1mdW5jdGlvbiBEKGEsYil7YT1tLmZyb21KU09OKGIpLmV2YWx1YXRlKGEpO2lmKHZvaWQgMCE9PWEpcmV0dXJue29wOiJ0ZXN0IixwYXRoOmIsdmFsdWU6YS52YWx1ZX19Y2xhc3MgbXtjb25zdHJ1Y3RvcihhPVsiIl0pe3RoaXMudG9rZW5zPWF9c3RhdGljIGZyb21KU09OKGEpe2NvbnN0IGI9CmEuc3BsaXQoIi8iKS5tYXAocik7aWYoIiIhPT1iWzBdKXRocm93IEVycm9yKGBJbnZhbGlkIEpTT04gUG9pbnRlcjogJHthfWApO3JldHVybiBuZXcgbShiKX10b1N0cmluZygpe3JldHVybiB0aGlzLnRva2Vucy5tYXAoRSkuam9pbigiLyIpfWV2YWx1YXRlKGEpe2xldCBiPW51bGwsYz0iIjtmb3IobGV0IGQ9MSxlPXRoaXMudG9rZW5zLmxlbmd0aDtkPGU7ZCsrKWI9YSxjPXRoaXMudG9rZW5zW2RdLCJfX3Byb3RvX18iIT1jJiYiY29uc3RydWN0b3IiIT1jJiYicHJvdG90eXBlIiE9YyYmKGE9KGJ8fHt9KVtjXSk7cmV0dXJue3BhcmVudDpiLGtleTpjLHZhbHVlOmF9fWdldChhKXtyZXR1cm4gdGhpcy5ldmFsdWF0ZShhKS52YWx1ZX1zZXQoYSxiKXtmb3IobGV0IGM9MSxkPXRoaXMudG9rZW5zLmxlbmd0aC0xLGU9dGhpcy50b2tlbnNbY107YzxkO2MrKylhPShhfHx7fSlbZV07YSYmKGFbdGhpcy50b2tlbnNbdGhpcy50b2tlbnMubGVuZ3RoLTFdXT1iKX1wdXNoKGEpe3RoaXMudG9rZW5zLnB1c2goYSl9YWRkKGEpe2E9CnRoaXMudG9rZW5zLmNvbmNhdChTdHJpbmcoYSkpO3JldHVybiBuZXcgbShhKX19Y29uc3Qgdz1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O2NsYXNzIG4gZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihhKXtzdXBlcihgVmFsdWUgcmVxdWlyZWQgYXQgcGF0aDogJHthfWApO3RoaXMucGF0aD1hO3RoaXMubmFtZT0iTWlzc2luZ0Vycm9yIn19Y2xhc3MgTiBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGEsYil7c3VwZXIoYFRlc3QgZmFpbGVkOiAke2F9ICE9ICR7Yn1gKTt0aGlzLmFjdHVhbD1hO3RoaXMuZXhwZWN0ZWQ9Yjt0aGlzLm5hbWU9IlRlc3RFcnJvciJ9fWNsYXNzIE8gZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihhKXtzdXBlcihgSW52YWxpZCBvcGVyYXRpb246ICR7YS5vcH1gKTt0aGlzLm9wZXJhdGlvbj1hO3RoaXMubmFtZT0iSW52YWxpZE9wZXJhdGlvbkVycm9yIn19cC5hcHBseVBhdGNoPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGIubWFwKGM9Pk0oYSxjKSl9OwpwLmNyZWF0ZVBhdGNoPWZ1bmN0aW9uKGEsYixjKXtjb25zdCBkPW5ldyBtO3JldHVybihjP1AoYyk6cSkoYSxiLGQpfTtwLmNyZWF0ZVRlc3RzPWZ1bmN0aW9uKGEsYil7Y29uc3QgYz1bXTtiLmZpbHRlcihGKS5mb3JFYWNoKGQ9Pntjb25zdCBlPUQoYSxkLnBhdGgpO2UmJmMucHVzaChlKTsiZnJvbSJpbiBkJiYoZD1EKGEsZC5mcm9tKSkmJmMucHVzaChkKX0pO3JldHVybiBjfTtPYmplY3QuZGVmaW5lUHJvcGVydHkocCwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSl9KTsK");
